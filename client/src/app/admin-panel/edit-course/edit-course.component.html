<div class="container">
    <div class="edit-course">
        <form class="form" [formGroup]="editCourseForm" #ngForm="ngForm" (ngSubmit)="onSubmit()">
            <div class="flex flex--not-even flex--align-center flex--between margin-bottom--small">
                <h2>{{ 'Edit Course' | translate }}</h2>
                <div>
                    <button type="button" class="button button--small button--secondary" routerLink="/admin-panel">{{ 'Go Back' | translate }}</button>
                </div>
            </div>

            <div class="section section--large">
                <div class="form-group">
                    <div class="flex flex-sm flex--align-center flex--not-even flex--between">
                        <label for="title" class="required">{{ 'Title' | translate }}</label>
                        <span class="slug">{{ 'Slug' | translate }}: {{ title.value | titleToSlug }}</span>
                    </div>
                    <div class="input-group"
                        [ngClass]="{ 'is-invalid' : (title.invalid && title.touched) || (title.invalid && ngForm.submitted) }">
                        <input type="text" id="title" formControlName="title"
                            placeholder="Course title">
                        <div class="input-help flex flex--not-even flex--align-center">
                            <div class="input-help-status"></div>
                            <div class="input-help-message">
                                <span>{{ 'Title is required!' | translate }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex">
                    <div class="form-group">
                        <label for="difficulty" class="required">{{ 'Difficulty' | translate }}</label>
                        <div class="input-group"
                            [ngClass]="{ 'is-invalid' : (difficulty.invalid && difficulty.touched) || (difficulty.invalid && ngForm.submitted) }">
                            <select formControlName="difficulty" id="difficulty">
                                <option value="">{{ 'Select difficulty' | translate }}</option>
                                <option value="beginner">{{ 'Beginner' | translate }}</option>
                                <option value="advanced">{{ 'Advanced' | translate }}</option>
                            </select>
                            <div class="input-help flex flex--not-even flex--align-center">
                                <div class="input-help-status"></div>
                                <div class="input-help-message">
                                    <span>{{ 'Course must have a difficulty!' | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="price" class="required">{{ 'Price' | translate }}</label>
                        <div class="input-group"
                            [ngClass]="{ 'is-invalid' : (price.invalid && price.touched) || (price.invalid && ngForm.submitted) }">
                            <input type="number" id="price" formControlName="price"
                                placeholder="{{ 'Enter course price' | translate }}">
                            <div class="input-help flex flex--not-even flex--align-center">
                                <div class="input-help-status"></div>
                                <div class="input-help-message">
                                    <span>{{ 'Price is required!' | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="status" class="required">{{ 'Status' | translate }}</label>
                    <div class="input-group"
                        [ngClass]="{ 'is-invalid' : (status.invalid && status.touched) || (status.invalid && ngForm.submitted) }">
                        <select formControlName="status" id="status">
                            <option value="private">{{ 'Private' | translate }}</option>
                            <option value="public">{{ 'Public' | translate }}</option>
                        </select>
                        <div class="input-help flex flex--not-even flex--align-center">
                            <div class="input-help-status"></div>
                            <div class="input-help-message">
                                <span>{{ 'Course must have a status!' | translate }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex">
                    <div class="form-group">
                        <label for="shortName" class="required">{{ 'Programming Language / Short Name' | translate }}</label>
                        <div class="input-group"
                            [ngClass]="{ 'is-invalid' : (shortName.invalid && shortName.touched) || (shortName.invalid && ngForm.submitted) }">
                            <input type="text" id="shortName" formControlName="shortName"
                                placeholder="{{ 'Enter course programming language / short name' | translate }}">
                            <div class="input-help flex flex--not-even flex--align-center">
                                <div class="input-help-status"></div>
                                <div class="input-help-message">
                                    <span>{{ 'Programming language / short name is required!' | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="color" class="required color-group-label">{{ 'Color' | translate }}</label>
                        <div class="input-group"
                            [ngClass]="{ 'is-invalid' : (color.invalid && color.touched) || (color.invalid && ngForm.submitted) }">
                            <div class="color-input-group flex flex-sm flex--not-even flex--align-center">
                                <input type="text" id="color" formControlName="color"
                                    placeholder="{{ 'Course color' | translate }}">
                                <div class="color-picker">
                                    <label class="flex" for="color-picker" [ngStyle]="{ 'background-color': color.value }">
                                        <img src="assets/icons/color-picker.svg" alt="color-picker">
                                        <input type="color" hidden id="color-picker" #colorPicker (change)="colorChanged(colorPicker.value)">
                                    </label>
                                </div>
                            </div>
                            <div class="input-help flex flex--not-even flex--align-center">
                                <div class="input-help-status"></div>
                                <div class="input-help-message">
                                    <span>{{ 'Color is required!' | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-sm flex--not-even flex--align-center">
                    <div class="form-group supported-language-group">
                        <label for="supportedLanguage" class="required">{{ 'Supported Languages' | translate }}</label>
                        <div class="input-group"
                            [ngClass]="{ 'is-invalid' : !supportedLanguage && supportedLanguageSubmitted }">
                            <input type="text" id="supportedLanguage" [ngModelOptions]="{standalone: true}" [(ngModel)]="supportedLanguage"
                                placeholder="{{ 'Enter supported language to add' | translate }}">
                            <div class="input-help flex flex--not-even flex--align-center">
                                <div class="input-help-status"></div>
                                <div class="input-help-message">
                                    <span>{{ 'Supported language can\'t be empty!' | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="add-language-button">
                        <button type="button" class="flex flex-sm" (click)="addSupportedLanguage()">
                            <img src="assets/icons/plus.svg" alt="plus">
                        </button>
                    </div>
                </div>
                <div class="supported-languages-list margin-bottom flex flex-sm flex--wrap flex--not-even flex--align-center">
                    <div class="supported-language flex flex-sm flex--not-even flex--align-center" *ngFor="let language of supportedLanguages; let i = index">
                        <span class="text--capitalize">{{ language | translate }}</span>
                        <div (click)="removeSupportedLanguage(i)" class="remove-supported-language">
                            <img src="assets/icons/remove-supported-language.svg" alt="remove-supported-language">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="description">{{ 'Course Description' | translate }}</label>
                    <div class="input-group"
                        [ngClass]="{ 'is-invalid' : (description.invalid && description.touched) || (description.invalid && ngForm.submitted) }">
                        <textarea formControlName="description" id="description" cols="30" rows="5"
                            placeholder="{{ 'Course description' | translate }}"></textarea>
                        <div class="input-help flex flex--not-even flex--align-center">
                            <div class="input-help-status"></div>
                            <div class="input-help-message">
                                <span *ngIf="description.errors?.required">{{ 'Description is required!' | translate }}</span>
                                <span *ngIf="description.errors?.maxlength">{{ 'Description must be contain less than' | translate }} {{ description.errors?.maxlength.requiredLength }} {{ 'characters!' | translate }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="margin-top">
                <file-upload [uploadText]="'Upload Course Image'" [imagePreview]="image.value" (onFileUpload)="onFileUpload($event)"></file-upload>
            </div>
            <div class="flex flex--not-even flex--between flex--align-start margin-top">
                <button type="submit" class="button button--large button--update" [disabled]="editCourseForm.invalid && ngForm.submitted">{{ 'Update Course' | translate }}</button>
                <div>
                    <div class="flex flex--not-even flex--center">
                        <button (click)="deleteCourse()" type="button" class="button button--large button--delete">{{ 'Delete Course' | translate }}</button>
                    </div>
                    <div class="flex flex--not-even flex--center">
                        <span class="course-delete-reminder">{{ 'and all its lectures' | translate }}</span>
                    </div>
                </div>
            </div>
        </form>
        <div class="flex flex--not-even flex--align-end flex--between margin-top margin-bottom--small">
            <h2>{{ 'Course Lectures' | translate }}</h2>
            <div class="filter-lectures">
                <input type="search" name="search" placeholder="{{ 'Search lectures' | translate }}" [(ngModel)]="searchInput" (input)="filterLectures()">
                <select name="status" [(ngModel)]="statusFilter" (change)="filterLectures()">
                    <option value="">{{ 'Filter by status' | translate }}</option>
                    <option value="private">{{ 'Private' | translate }}</option>
                    <option value="public">{{ 'Public' | translate }}</option>
                </select>
            </div>
        </div>
        <div class="course-lectures-list">
            <div class="course-lecture" *ngFor="let lecture of courseLectures; let i = index">
                <div class="flex flex--not-even flex--between flex--align-center">
                    <div class="lecture-title flex flex--not-even flex--align-center">
                        <img (click)="toggleLectureStatus(i)" *ngIf="lecture.status === 'public'" src="assets/icons/users.svg" alt="users" title="This lecture is public">
                        <img (click)="toggleLectureStatus(i)" *ngIf="lecture.status === 'private'" src="assets/icons/user-lock.svg" alt="user-lock" title="This lecture is private">
                        <span [ngClass]="{ 'private-lecture-title': lecture.status === 'private' }" routerLink="{{'/lecture/' + lecture.slug}}">{{ lecture.title | translate }}</span>
                    </div>
                    <div class="lecture-actions flex flex--not-even flex--align-center">
                        <span routerLink="/admin-panel/edit-lecture/{{lecture.id}}" class="edit-lecture flex flex--not-even flex--align-center">
                            <img src="assets/icons/edit.svg" alt="pencil">
                            <span>{{ 'Edit' | translate }}</span>
                        </span>
                        <span (click)="deleteLecture(lecture.id, i)" class="delete-lecture flex flex--not-even flex--align-center">
                            <img src="assets/icons/delete.svg" alt="trash-can">
                            <span>{{ 'Delete' | translate }}</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="no-lectures text--center" *ngIf="courseLectures.length < 1">
                <img src="/assets/icons/frown.svg" alt="frown">
                <p>{{ 'No lectures created yet' | translate }}</p>
            </div>
        </div>
        <button [routerLink]="'/admin-panel/new-lecture/' + course.id" class="button button--create margin-top">{{ 'Create lecture for course' | translate }}</button>
    </div>
</div>